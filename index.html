<!DOCTYPE html>
<html style="width:100%;height:100%;background-color:black;">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="EaglyMC 1.20 Optimized" />
  <meta name="keywords" content="eaglercraft, eaglercraftx, minecraft, 1.8, 1.8.8" />
  <title>HZ EaglyMC</title>
  <link type="image/png" rel="shortcut icon" href="favicon.png" />
  <script type="text/javascript" src="classes.js" defer></script>

  <script type="text/javascript">
    "use strict";
    window.addEventListener("load", function() {
      if(window.location.href.indexOf("file:") === 0) {
        alert("Run this with HTTP (not file://)");
      } else {
        var relayId = Math.floor(Math.random() * 3);

        window.eaglercraftXOpts = {
          demoMode: false,
          container: "game_frame",
          assetsURI: "assets.epk",
          localesURI: "lang/",
          worldsDB: "worlds",
          logInvalidCerts: false,
          crashOnUncaughtExceptions: false,
          maxParticles: 500,             // reduce particle overhead
          disableInstancedRendering: true, // safer for Safari WebGL
          smoothGui: false,              // disable GUI animations
          renderScale: 0.5,              // render at 50% resolution for FPS boost
          servers: [
            { addr: "wss://play.eaglernet.net", name: "EaglerNet OneBlock" },
            { addr: "wss://ob.webmc.xyz", name: "WebMC OneBlock" },
            { addr: "ws://localhost:8081/", name: "Local test server" }
          ],
          relays: [
            { addr: "wss://relay.deev.is/", comment: "relay #1", primary: relayId === 0 },
            { addr: "wss://relay.lax1dude.net/", comment: "relay #2", primary: relayId === 1 },
            { addr: "wss://relay.shhnowisnottheti.me/", comment: "relay #3", primary: relayId === 2 }
          ]
        };

        // After main() loads, force-disable expensive effects & set visuals low
        let patchInterval = setInterval(() => {
          if (window.EaglercraftX && window.EaglercraftX.settings) {
            window.EaglercraftX.settings.useFXAA = false;       // disable anti-alias
            window.EaglercraftX.settings.dynamicLights = false; // disable dynamic lights

            // Extra visual optimizations
            window.EaglercraftX.settings.renderDistance = 6;
            window.EaglercraftX.settings.smoothLighting = false;
            window.EaglercraftX.settings.clouds = false;
            window.EaglercraftX.settings.particles = "minimal";
            window.EaglercraftX.settings.graphics = "fast";
            window.EaglercraftX.settings.entityShadows = false;
            window.EaglercraftX.settings.mipmapLevels = 0;

            clearInterval(patchInterval);
          }
        }, 2000);

        // Start game
        main();

        // Automatically override VSync after game starts
        setTimeout(() => {
          if (window.EaglercraftX && window.EaglercraftX.mainLoop) {
            let oldLoop = window.EaglercraftX.mainLoop;
            function noVsyncLoop() {
              oldLoop();
              setTimeout(noVsyncLoop, 0); // run as fast as possible
            }
            noVsyncLoop();
            console.log("⚡ VSync override enabled: running without requestAnimationFrame");
          }
        }, 3000);

        // Async chunk loading patch
        setTimeout(() => {
          if (window.EaglercraftX && window.EaglercraftX.chunkBuilder) {
            let oldBuild = window.EaglercraftX.chunkBuilder.buildNext;
            window.EaglercraftX.chunkBuilder.buildNext = function() {
              setTimeout(() => oldBuild.call(window.EaglercraftX.chunkBuilder), 1);
            };
            console.log("⚡ Chunk builder patched: async mode enabled");
          }
        }, 5000);
      }
    });
  </script>
</head>
<body style="margin:0px;width:100%;height:100%;overflow:hidden;background-color:black;" id="game_frame">
</body>
</html>
